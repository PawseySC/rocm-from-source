BootStrap: docker
From: ubuntu:20.04


%setup
    mkdir ${SINGULARITY_ROOTFS}/rocm-from-source
    cp -r common *.sh ${SINGULARITY_ROOTFS}/rocm-from-source

%post
    ln -s /usr/share/zoneinfo/Australia/Perth /etc/localtime
    apt-get -y update
    export CPATH=/usr/include/python3.9:$CPATH
    /rocm-from-source/ubuntu_install_rocm.sh
    rm -rf /rocm-from-source
    
%environment
    source /opt/rocm/rocm-5.3.0rev0/rocm_setup.sh


%labels
    Author Pawsey Supercomputing Research Centre
    Version v5.3.0rev0

%help
    This is a custom build of ROCm developed by the Pawsey Supercomputing Research Centre.
